import{get_store_value as o,SvelteComponent as e,init as s,safe_not_equal as r,binding_callbacks as a,bind as t,element as c,create_component as i,attr as l,insert as n,mount_component as d,add_flush_callback as m,transition_in as u,transition_out as f,detach as p,destroy_component as k,createEventDispatcher as j,onMount as b}from"./node_modules/svelte/internal/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/auth/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/auth/enums.js";import g from"./node_modules/@forgerock/javascript-sdk/lib-esm/config/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/event/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/attribute-input-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/choice-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/confirmation-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/device-profile-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/hidden-value-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/kba-create-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/metadata-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/name-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/password-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/polling-wait-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/recaptcha-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/redirect-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/select-idp-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/suspended-text-output-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/terms-and-conditions-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/text-output-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-password-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-username-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/enums.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-failure.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-success.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-step.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-device/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/message-creator.js";import h from"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-user/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/index.js";import v from"./node_modules/@forgerock/javascript-sdk/lib-esm/http-client/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/oauth2-client/index.js";import _ from"./node_modules/@forgerock/javascript-sdk/lib-esm/session-manager/index.js";import x from"./node_modules/@forgerock/javascript-sdk/lib-esm/token-manager/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/index.js";import $ from"./node_modules/@forgerock/javascript-sdk/lib-esm/user-manager/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/util/pkce.js";import y from"./src/lib/components/compositions/dialog/dialog.js";import w from"./src/lib/journey/journey.js";import E from"./src/lib/config/config.js";import{initialize as C}from"./src/lib/journey/journey.store.js";import{initialize as z}from"./src/lib/locale.store.js";import{initialize as I}from"./src/lib/oauth/oauth.store.js";import{initialize as M}from"./src/lib/user/user.store.js";function T(o){let e,s,r;function c(e){o[7](e)}let l={journeyStore:o[4]};return void 0!==o[2]&&(l.formEl=o[2]),e=new w({props:l}),a.push((()=>t(e,"formEl",c))),{c(){i(e.$$.fragment)},m(o,s){d(e,o,s),r=!0},p(o,r){const a={};!s&&4&r&&(s=!0,a.formEl=o[2],m((()=>s=!1))),e.$set(a)},i(o){r||(u(e.$$.fragment,o),r=!0)},o(o){f(e.$$.fragment,o),r=!1},d(o){k(e,o)}}}function U(o){let e,s,r,j;function b(e){o[8](e)}let g={closeCallback:o[3],dialogId:"sampleDialog",$$slots:{default:[T]},$$scope:{ctx:o}};return void 0!==o[1]&&(g.dialogEl=o[1]),s=new y({props:g}),a.push((()=>t(s,"dialogEl",b))),o[9](s),{c(){e=c("div"),i(s.$$.fragment),l(e,"class","fr_widget-root")},m(o,r){n(o,e,r),d(s,e,null),j=!0},p(o,[e]){const a={};8196&e&&(a.$$scope={dirty:e,ctx:o}),!r&&2&e&&(r=!0,a.dialogEl=o[1],m((()=>r=!1))),s.$set(a)},i(o){j||(u(s.$$.fragment,o),j=!0)},o(o){f(s.$$.fragment,o),j=!1},d(r){r&&p(e),o[9](null),k(s)}}}let D,L,S,W,q,F,P,R,A;const B={start(o){const e=o?.oauth||!0,s=o?.user||!0;let r,a,t=q.subscribe((o=>{!e&&o.successful?(R&&R({journey:o}),G.close({reason:"auto"})):e&&o.successful?(r=o,F.get({forceRenew:!0})):o.error&&(r=o,P&&P({journey:o})),o.successful&&t()})),c=F.subscribe((o=>{!s&&o.successful?(R&&R({journey:r,oauth:o}),G.close({reason:"auto"})):s&&o.successful?(a=o,A.get()):o.error&&(a=o,P&&P({journey:r,oauth:o})),o.successful&&c()})),i=A.subscribe((o=>{o.successful?(R&&R({journey:r,oauth:a,user:o}),G.close({reason:"auto"})):o.error&&P&&P({journey:r,oauth:a,user:o}),o.successful&&i()}));q.next()},onFailure(o){P=e=>o(e)},onSuccess(o){R=e=>o(e)}},G={close(o){D.closeDialog(o)},onClose(o){W=e=>o(e)},onMount(o){S=(e,s)=>o(e,s)},open(){o(q).step||B.start(),L.showModal()}},H=async o=>await v.request(o),J={authorized:async(o=!1)=>o?!!await $.getCurrentUser():!!await x.getTokens(),info:async(e=!1)=>e?await $.getCurrentUser():o(A).response,async logout(){const{clientId:o}=g.get();o?await h.logout():await _.logout(),q.reset(),F.reset(),A.reset(),B.start()},tokens:async o=>await x.getTokens(o)};function K(o,e,s){let{config:r}=e,{content:t}=e;const c=j();let i,l,n,d=W;E({clientId:"WebLoginWidgetClient",realmPath:"alpha",redirectUri:"object"==typeof window?window.location.href:"https://localhost:3000/callback",scope:"openid email",tree:"Login",...r,support:"legacy"});let m=q=C(r);return F=I(r),A=M(r),z(t),b((()=>{D=i,L=l,S&&S(l,n),setTimeout((()=>{c("modal-mount","Modal mounted")}),0)})),o.$$set=o=>{"config"in o&&s(5,r=o.config),"content"in o&&s(6,t=o.content)},[i,l,n,d,m,r,t,function(o){n=o,s(2,n)},function(o){l=o,s(1,l)},function(o){a[o?"unshift":"push"]((()=>{i=o,s(0,i)}))}]}class N extends e{constructor(o){super(),s(this,o,K,U,r,{config:5,content:6})}}export{N as default,B as journey,G as modal,H as request,J as user};