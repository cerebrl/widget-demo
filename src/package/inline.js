import{get_store_value as e,SvelteComponent as o,init as s,safe_not_equal as r,binding_callbacks as a,bind as t,element as c,create_component as i,attr as l,insert as d,mount_component as m,add_flush_callback as n,transition_in as u,transition_out as k,detach as p,destroy_component as f,createEventDispatcher as j,onMount as b}from"./node_modules/svelte/internal/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/auth/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/auth/enums.js";import g from"./node_modules/@forgerock/javascript-sdk/lib-esm/config/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/event/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/attribute-input-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/choice-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/confirmation-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/device-profile-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/hidden-value-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/kba-create-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/metadata-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/name-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/password-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/polling-wait-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/recaptcha-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/redirect-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/select-idp-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/suspended-text-output-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/terms-and-conditions-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/text-output-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-password-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-username-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/enums.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-failure.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-success.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-step.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-device/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/message-creator.js";import v from"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-user/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/http-client/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/oauth2-client/index.js";import h from"./node_modules/@forgerock/javascript-sdk/lib-esm/session-manager/index.js";import _ from"./node_modules/@forgerock/javascript-sdk/lib-esm/token-manager/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/index.js";import x from"./node_modules/@forgerock/javascript-sdk/lib-esm/user-manager/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/util/pkce.js";import y from"./src/lib/journey/journey.js";import w from"./src/lib/config/config.js";import{initialize as $}from"./src/lib/journey/journey.store.js";import{initialize as z}from"./src/lib/locale.store.js";import{initialize as C}from"./src/lib/oauth/oauth.store.js";import{initialize as E}from"./src/lib/user/user.store.js";function T(e){let o,s,r,j;function b(o){e[4](o)}let g={journeyStore:e[1]};return void 0!==e[0]&&(g.formEl=e[0]),s=new y({props:g}),a.push((()=>t(s,"formEl",b))),{c(){o=c("div"),i(s.$$.fragment),l(o,"class","fr_widget-root")},m(e,r){d(e,o,r),m(s,o,null),j=!0},p(e,[o]){const a={};!r&&1&o&&(r=!0,a.formEl=e[0],n((()=>r=!1))),s.$set(a)},i(e){j||(u(s.$$.fragment,e),j=!0)},o(e){k(s.$$.fragment,e),j=!1},d(e){e&&p(o),f(s)}}}let U,I,L,S,W,F;const M={start(e){const o=e?.oauth||!0,s=e?.user||!0;let r,a,t=I.subscribe((e=>{!o&&e.successful?W&&W({journey:e}):o&&e.successful?(r=e,L.get({forceRenew:!0})):e.error&&(r=e,S&&S({journey:e})),e.completed&&t()})),c=L.subscribe((e=>{!s&&e.successful?W&&W({journey:r,oauth:e}):s&&e.successful?(a=e,F.get()):e.error&&(a=e,S&&S({journey:r,oauth:e})),e.completed&&c()})),i=F.subscribe((e=>{e.successful?W&&W({journey:r,oauth:a,user:e}):e.error&&S&&S({journey:r,oauth:a,user:e}),e.completed&&i()}));I.next()},onFailure(e){S=o=>e(o)},onSuccess(e){W=o=>e(o)}},P={onMount(e){U=o=>e(o)}},R={authorized:async(e=!1)=>e?!!await x.getCurrentUser():!!await _.getTokens(),info:async(o=!1)=>o?await x.getCurrentUser():e(F).response,async logout(){const{clientId:e}=g.get();e?await v.logout():await h.logout(),I.reset(),L.reset(),F.reset(),M.start()},tokens:async e=>await _.getTokens(e)};function q(e,o,s){let{config:r}=o,{content:a}=o;const t=j();let c;w({clientId:"WebLoginWidgetClient",realmPath:"alpha",redirectUri:"object"==typeof window?window.location.href:"https://localhost:3000/callback",scope:"openid email",tree:"Login",...r,support:"legacy"});let i=I=$(r);return L=C(r),F=E(r),z(a),b((()=>{U&&U(c),setTimeout((()=>{t("form-mount",c)}),0)})),e.$$set=e=>{"config"in e&&s(2,r=e.config),"content"in e&&s(3,a=e.content)},[c,i,r,a,function(e){c=e,s(0,c)}]}class A extends o{constructor(e){super(),s(this,e,q,T,r,{config:2,content:3})}}export{A as default,P as form,M as journey,R as user};