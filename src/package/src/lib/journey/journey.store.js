import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/auth/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/auth/enums.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/config/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/event/index.js";import e from"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/attribute-input-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/choice-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/confirmation-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/device-profile-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/hidden-value-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/kba-create-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/metadata-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/name-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/password-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/polling-wait-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/recaptcha-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/redirect-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/select-idp-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/suspended-text-output-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/terms-and-conditions-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/text-output-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-password-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-username-callback.js";import{StepType as s}from"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/enums.js";import o from"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-failure.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-success.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-step.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-device/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/message-creator.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-user/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/http-client/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/oauth2-client/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/session-manager/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/token-manager/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/user-manager/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/util/pkce.js";import{writable as r}from"../../../node_modules/svelte/store/index.js";import{htmlDecode as a}from"./_utilities/decode.utilities.js";import{interpolate as l}from"../_utilities/i18n.utilities.js";import{shouldPopulateWithPreviousCallbacks as t,authIdTimeoutErrorCode as c}from"./_utilities/step.utilities.js";function i(i){const{set:d,subscribe:m}=r({completed:!1,error:null,loading:!1,step:null,successful:!1,response:null});let p=0;return{next:async function(r=null,m){const n={...i,...m};let u;r&&r.type===s.Step&&(r?.getStage&&r.getStage(),u=r?.callbacks);const k=r?.payload;let f;d({completed:!1,error:null,loading:!0,step:r,successful:!1,response:null});try{f=await e.next(r,n)}catch(e){console.error(`Next step request | ${e}`),f=new o({message:l("unknownNetworkError")})}if(f.type===s.Step)p+=1,d({completed:!1,error:null,loading:!1,step:f,successful:!1,response:null});else if(f.type===s.LoginSuccess)d({completed:!0,error:null,loading:!1,step:null,successful:!0,response:f.payload});else if(f.type===s.LoginFailure){const i=a(f.payload.message||"");let m=null;try{m=await e.next(void 0,n)}catch(e){console.error(`Restart failed step request | ${e}`),m=new o({message:l("unknownNetworkError")})}if(t(f,u,m,p)){m.callbacks=u,m.payload={...k,authId:m.payload.authId};f.payload.detail?.errorCode===c&&(m=await e.next(m,n))}m.type===s.Step?d({completed:!1,error:{code:f.getCode(),message:i,step:r?.payload},loading:!1,step:m,successful:!1,response:null}):m.type===s.LoginSuccess?d({completed:!0,error:null,loading:!1,step:null,successful:!0,response:m.payload}):d({completed:!0,error:{code:f.getCode(),message:i,step:r?.payload},loading:!1,step:null,successful:!1,response:m.payload})}},reset:function(){d({completed:!1,error:null,loading:!1,step:null,successful:!1,response:null})},subscribe:m}}export{i as initialize};